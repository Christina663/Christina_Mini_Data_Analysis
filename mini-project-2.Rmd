---
title: "Mini Data Analysis Milestone 2"
output: github_document
---

# Welcome back to my mini data analysis project!

This time, we will explore more in depth the concept of *tidy data*, and investigate further into my research questions that was defined in milestone 1. We will be using the dataset "vancouver_trees" to investigate patterns of Japanese originated tree species spreading across the area of Vancouver. Let's get started!

Begin by loading data, and the packages datateachr, tidyverse, ggplot2 as follows: 

```{r, message = FALSE}
suppressPackageStartupMessages(library(datateachr)) # <- might contain the data you picked!
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(ggplot2))
```

# Task 1: Process and summarize your data (15 points)

From milestone 1, we have an idea of the basic structure of my dataset (e.g. number of rows and columns, class types,a lot of NA values, etc.). Here, we will start investigating your data more in-depth using various data manipulation functions. 

### 1.1 (2.5 points) 

First, write out the 4 research questions you defined in milestone 1 were. This will guide your work through milestone 2:

<!-------------------------- Student work below ---------------------------->
1. For all trees that have common names starting with "Japanese", how are they spread across the city of Vancouver? Do they gather in groups by different species? Were they only planted in a small subarea of Vancouver? 
2. For these "Japanese" trees of different species, how are their size related to their species? Which species have a tall and slim figure, and which have a short and round shape? 
3. How are trees of different heights spread across different areas within Vancouver? Do they follow any patterns (e.g. similar height on the same street)? 
4. If investigating times of falling leaves for different tree species, how will it affect each areas of Vancouver with different color of trees, amount of tree shadow, etc? 
<!----------------------------------------------------------------------------->

### 1.2 (10 points)

Now, for each of my four research questions, I will choose one task from options 1-4 (summarizing), and one other task from 4-8 (graphing). 

**Summarizing:**

1. Compute the *range*, *mean*, and *two other summary statistics* of **one numerical variable** across the groups of **one categorical variable** from your data.
2. Compute the number of observations for at least one of your categorical variables. Do not use the function `table()`!
3. Create a categorical variable with 3 or more groups from an existing numerical variable. You can use this new variable in the other tasks! *An example: age in years into "child, teen, adult, senior".*
4. Based on two categorical variables, calculate two summary statistics of your choosing.

**Graphing:**

5. Create a graph out of summarized variables that has at least two geom layers.
6. Create a graph of your choosing, make one of the axes logarithmic, and format the axes labels so that they are "pretty" or easier to read. 
7. Make a graph where it makes sense to customize the alpha transparency.
8. Create 3 histograms out of summarized variables, with each histogram having different sized bins. Pick the "best" one and explain why it is the best.

<!------------------------- Student work below ----------------------------->
Before we dive into our research questions, let's update our dataset to the refined one from last milestone - we use this new dataset with unnecessary variables and extreme values taken out and keep only the trees of Japanese origin. 
```{r}
# Look at all common_name present in the dataset
unique(select(vancouver_trees, common_name))
# Select only those starting with Japanese and put into a variable of common_name
selected_common_name = c("JAPANESE SNOWBELL", "JAPANESE DOGWOOD", "JAPANESE ZELKOVA", "JAPANESE BEECH", "JAPANESE MAPLE", "JAPANESE FLOWERING CRABAPPLE", "JAPANESE STEWARTIA", "JAPANESE STEWARTIA", "JAPANESE HORNBEAM", "JAPANESE PAGODA TREE", "JAPANESE CRYPTOMERIA", "JAPANESE WALNUT", "JAPANESE ANGELICA TREE", "JAPANESE WHITE PINE", "JAPANESE BLACK PINE", "JAPANESE CHESTNUT")
# Create a new tibble containing only Japanese originated trees and take out some irrelevant variables and extreme values
Japanese_trees <- vancouver_trees %>%
  select(-civic_number, -assigned, -cultivar_name, -street_side_name, -longitude, -latitude) %>%
  #filter(size < 7.5*10^3, diameter < 40) %>%
  filter(common_name %in% selected_common_name)
```

*Research Question 1:*
*For all trees that have common names starting with "Japanese", how are they spread across the city of Vancouver? Do they gather in groups by different species? Were they only planted in a small subarea of Vancouver?*
*Summarizing task 2 - Count number of observations for categorical variables*
We will look at different species of the Japanese trees and how each species are distributed among different neighborhoods in the city of Vancouver. We apply the summarise() function to sort all Japanese trees into groups of neighborhood names and their species, and count the number of trees per species inside each neighborhood.

```{r}
answer1.1 <- vancouver_trees %>%
  group_by(neighbourhood_name, common_name) %>%
  summarise(n = n())
  
print(answer1.1)  
```
From the tibble above, we observe very spread-out number of trees for different species, for example, we have 92 "AMERICAN ELM" in the neighborhood ARBUTUS-RIDGE, whereas the other species are around 10 in this neighborhood. Thus  helps us understand the distribution of tree species from research question 1.

*Graphing task 5 - Graph with two geom layers*
Continuing with the summarised tibble from above, we will focus on the spread of trees of different species on the specific street "Dunbar Southlands" which stretches from west to east of Vancouver. In total there are 7 neighborhoods along the street, and we will plot the distribution of number of trees among different species, for each neighborhood on the street.
```{r}
answer1.1 %>%
filter(neighbourhood_name %in% c("DUNBAR-SOUTHLANDS", "ARBUTUS-RIDGE", "SHAUGHNESSY", "RILEY PARK",  "KENSINGTON-CEDAR COTTAGE", "RENFREW-COLLINGWOOD") ) %>%
  ggplot(aes(x = common_name, y = n)) + geom_point(color = "pink") + geom_line(color = "purple", group = 1) + facet_wrap("neighbourhood_name") + theme(axis.text.x=element_blank(), axis.ticks.x=element_blank())
```
From the line plot, we can conclude that there are two species that are extremely common in all of the neighborhood on "Dunbar Southlands". Specifically, there are two significant spikes on every line plot that are of the exact same x value, meaning these two species have large counts for all the facets. This helps us gain better understanding of the tree species distribution by explicitly presenting their counts comparing to other species.

*Research Question 2:*
*For these "Japanese" trees of different species, how are their size related to their species? Which species have a tall and slim figure, and which have a short and round shape?*

*Summarizing task 3 - Make new categorical variable*
We will make a set of new variables: "height_level" and "diameter_level" to classify these two parameters into categories. We will have heights as "tall", "medium" or "short" and diameters as "thick", "medium" and "slim". 
```{r}
print(range(select(vancouver_trees, height_range_id)))
print(range(select(vancouver_trees, diameter)))
vancouver_trees %>%
  mutate(height_level = case_when(height_range_id < 3 ~ "short",
                                 height_range_id < 6 ~ "medium",
                                 TRUE ~ "tall")) %>%
  mutate(diameter_level = case_when(diameter < 10 ~ "slim",
                                 diameter < 30 ~ "medium",
                                 TRUE ~ "thick"))
```
From the tibble above, we have a better understanding of the distribution of height and diameter of different Japanese tree species and thus helps us comprehend research question 2. We can just look at the new variables "height_level" and "diameter_level", and make the observation that most trees are in the medium category, for both height and diameter; and we can continue working with these new variables and explore the relationship between species and height, weight levels!


*Graphing task
We are going to explore the distribution of trees height and diameter across each species. In other words, we observing which species have larger heights and/or diameters, and which have smaller heights and/or diameters. A line plot will be used to demonstrate the distribution. We also filtered out species to only include five species that sound pretty!
```{r}
vancouver_trees %>%
  filter(common_name %in% c("JAPANESE SNOWBELL", "JAPANESE DOGWOOD", "JAPANESE ZELKOVA", "JAPANESE BEECH","JAPANESE MAPLE")) %>%
  group_by(common_name) %>%
  summarise(height_mean = mean(height_range_id, na.rm = TRUE), diameter_mean = mean(diameter, na.rm = TRUE)) %>%
  ggplot(aes(x = common_name)) + geom_line(aes(y = height_mean), group = 1, color = "red") + geom_line(aes(y = diameter_mean), group = 1, color = "green") + geom_point(aes(y = height_mean), color = "black", size = 3) + geom_point(aes(y = diameter_mean), color = "black", size = 3)
```
From the line plots above, we can observe the height-diameter relationship for the five tree species that we chose. For example: JAPANESE ZELKOVA and JAPANESE BEECH both have large heights and diameters (i.e. tall and thick), and JAPANESE SNOWBELL has both small heights and diameters (i.e. short and slim). These comparison between the height plot and diameter plot helps us easily identify the relationship we want from research question 2.

*Research Question 3:*
*How are trees of different heights spread across different areas within Vancouver? Do they follow any patterns (e.g. similar height on the same street)?*
*Summarizing task 1 - Compute summary statistics of one numerical variable across one categorical variable*
We will look at different categories of "neighbourhood_name" of the trees and explore their height statistics (e.g. mean, range, standard deviation, count of trees per neighborhood):

```{r}
answer3.1 <- vancouver_trees %>%
  group_by(neighbourhood_name) %>%
  summarise(height_mean = mean(height_range_id, na.rm = TRUE), height_min = min(height_range_id, na.rm = TRUE), height_max = max(height_range_id, na.rm = TRUE), height_std = sd(height_range_id, na.rm = TRUE), count = n())
  
print(answer3.1)
```
From the summarized tibble above, we can observe the height characteristics of trees based on different statistical variables such as mean, standard deviation, range and count per group, etc.This helps understand my research question 3 in how heights of Japanese trees are spread across different neighborhoods in Vancouver.

*Graphing task 5 - Graph with two geom layers*
We will investigate the spread of trees of different height on the specific street "Dunbar Southlands", and plot the mean heights of trees against each neighborhood on the street (i.e. y = mean height, x = neighborhood).
```{r}
 # Filter the summarized tibble to include only neighborhoods along Dunbar Southland
vancouver_trees %>%
  group_by(neighbourhood_name) %>%
  summarise(height_mean = mean(height_range_id, na.rm = TRUE), height_max = max(height_range_id, na.rm = TRUE), height_std = sd(height_range_id, na.rm = TRUE)) %>%
  filter(neighbourhood_name %in% c("DUNBAR-SOUTHLANDS", "ARBUTUS-RIDGE", "SHAUGHNESSY", "RILEY PARK",  "KENSINGTON-CEDAR COTTAGE", "RENFREW-COLLINGWOOD") ) %>%
  # Plot height means of each neighborhood, with both a geom_point layer and geom_col to display the trends of tree heights along the street, changing from west to east of the street.
  ggplot(aes(x = neighbourhood_name, y = height_mean)) + geom_point(size = 5, color = 'black') + geom_col(fill = 'pink')+ theme(axis.text.x=element_blank(), axis.ticks.x=element_blank())
 
```
From the plot above, we can see that each neighborhoods along the Dunbar Southlands street of Vancouver has Japanese trees of different mean heights, specifically the neighborhoods that are closer to the sea have larger mean height values, which answers the research question 3, again.

*Research Question 4:*
*If investigating times of falling leaves for different tree species, how will it affect each areas of Vancouver with different color of trees, amount of tree shadow, etc?*

*Summarizing task 3 - Compute number of observations*
And for our last research question, we will be investigating the color of fall foliage (i.e. tree colors in fall) of the Japanese trees across Vancouver, specifically in those eight neighborhoods along Dunbar Southlands! We will first do some research to find out what are the fall foliage like for each different tree species, and make a new categorical variable named "fall foliage" and fill out for each observation. And finally we will summarize the count of each foliage color in each neighborhood.


```{r}
answer4.1 <- Japanese_trees %>%
  mutate(fall_foliage = case_when(common_name == "JAPANESE SNOWBELL" ~ "red",
                                  common_name == "JAPANESE ZELKOVA" ~ "red",
                                  common_name == "JAPANESE MAPLE" ~ "brown",
                                  common_name == "JAPANESE FLOWERING CRABAPPLE" ~ "yellow",
                                  common_name == "JAPANESE STEWARTIA" ~ "red",
                                  common_name == "JAPANESE HORNBEAM" ~ "yellow",
                                  common_name == "JAPANESE PAGODA TREE" ~ "yellow",
                                  common_name == "JAPANESE CRYPTOMERIA" ~ "brown",
                                  common_name == "JAPANESE WALNUT" ~ "yellow",
                                  common_name == "JAPANESE ANGELICA TREE" ~ "brown",
                                  common_name == "JAPANESE WHITE PINE" ~ "green",
                                  common_name == "JAPANESE BLACK PINE" ~ "green",
                                  common_name == "JAPANESE CHESTNUT" ~ "red",
                                 TRUE ~ "NA")) %>%
  select(tree_id, common_name, neighbourhood_name, fall_foliage) %>%
  filter(fall_foliage != "NA") %>%
  group_by(neighbourhood_name, fall_foliage) 
print(answer4.1)
summarise(answer4.1, count = n())

```
From the summarized tibble above, we can easily observe the count for each fall foliage color (i.e. yellow, red, brown or green) for each neighborhood. And by looking at these count and the difference between them, we can thus gain a better understanding of research question 4 in how trees of different fall foliage colors are spread across each neighborhood.

*Graphing task 
*Now we would like to continue with fall foliage colors and make visualizations of how each neighborhood looks like when filled in with different colors of trees! We will make point plots of each tree observation showing their color on the plot.

```{r}
answer4.1 %>%
  #filter(neighbourhood_name == "DUNBAR-SOUTHLANDS") %>%
  #summarise(answer4.1, count = n()) %>%
  ggplot(aes(neighbourhood_name, y = fall_foliage)) + geom_jitter(alpha = 0.3, width  = 0.2) # How to show different colors?
```
From the plot ablove, ...
<!----------------------------------------------------------------------------->

### 1.3 (2.5 points)

Based on the operations that you've completed, how much closer are you to answering your research questions? Think about what aspects of your research questions remain unclear. Can your research questions be refined, now that you've investigated your data a bit more? Which research questions are yielding interesting results?

<!------------------------- Write your answer here ---------------------------->


<!----------------------------------------------------------------------------->

# Task 2: Tidy your data (12.5 points)

In this task, we will do several exercises to reshape our data. The goal here is to understand how to do this reshaping with the `tidyr` package.

A reminder of the definition of *tidy* data:

- Each row is an **observation**
- Each column is a **variable**
- Each cell is a **value**

*Tidy'ing* data is sometimes necessary because it can simplify computation. Other times it can be nice to organize data so that it can be easier to understand when read manually. 

### 2.1 (2.5 points)

Based on the definition above, can you identify if your data is tidy or untidy? Go through all your columns, or if you have >8 variables, just pick 8, and explain whether the data is untidy or tidy.

<!--------------------------- Start your work below --------------------------->


<!----------------------------------------------------------------------------->

### 2.2 (5 points)

Now, if your data is tidy, untidy it! Then, tidy it back to it's original state.

If your data is untidy, then tidy it! Then, untidy it back to it's original state.

Be sure to explain your reasoning for this task. Show us the "before" and "after".

<!--------------------------- Start your work below --------------------------->


<!----------------------------------------------------------------------------->

### 2.3 (5 points)

Now, you should be more familiar with your data, and also have made progress in answering your research questions. Based on your interest, and your analyses, pick 2 of the 4 research questions to continue your analysis in milestone 3, and explain your decision. 

Try to choose a version of your data that you think will be appropriate to answer these 2 questions in milestone 3. Use between 4 and 8 functions that we've covered so far (i.e. by filtering, cleaning, tidy'ing, dropping irrelvant columns, etc.). 

<!--------------------------- Start your work below --------------------------->


<!----------------------------------------------------------------------------->

*When you are done, knit an `md` file. This is what we will mark! Make sure to open it and check that everything has knitted correctly before submitting your tagged release.*

### Attribution

Thanks to Victor Yuan for mostly putting this together. 